    // Handle password reset request
    function handlePasswordReset(phone) {
        // Check if phone is registered
        const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers'));
        let isPhoneRegistered = false;
        
        for (const email in registeredUsers) {
            if (registeredUsers[email].phone === phone) {
                isPhoneRegistered = true;
                break;
            }
        }
        
        if (!isPhoneRegistered) {
            showNotification('This phone number is not registered. Please sign up first.', 'error');
            return;
        }
        
        // Check SMS cooldown
        const currentTime = new Date().getTime();
        if (currentTime - lastSmsSentTime < smsCooldown) {
            const remainingTime = Math.ceil((smsCooldown - (currentTime - lastSmsSentTime)) / 1000);
            showNotification(`Please wait ${remainingTime} seconds before requesting another OTP.`, 'warning');
            return;
        }
        
        // Generate OTP
        generatedOtp = generateOtp();
        resetPhone = phone;
        
        // Simulate sending SMS (in a real app, this would call an SMS API)
        simulateSendSms(phone, `Your Pocket Lawyer OTP is: ${generatedOtp}. It will expire in 2 minutes.`);
        
        // Update last SMS sent time
        lastSmsSentTime = currentTime;
        
        // Show OTP modal
        forgotPasswordModal.classList.remove('show');
        otpModal.classList.add('show');
        
        // Start OTP timer
        startOtpTimer();
        
        showNotification('OTP sent to your phone number.', 'success');
    }
    
    // Generate a 6-digit OTP
    function generateOtp() {
        return Math.floor(100000 + Math.random() * 900000).toString();
    }
    
    // Start OTP expiration timer
    function startOtpTimer() {
        clearInterval(otpTimer);
        
        const timerDisplay = document.getElementById('otpTimer');
        otpExpiryTime = new Date().getTime() + 120000; // 2 minutes from now
        
        updateTimerDisplay(timerDisplay);
        
        otpTimer = setInterval(() => {
            const timeLeft = updateTimerDisplay(timerDisplay);
            
            if (timeLeft <= 0) {
                clearInterval(otpTimer);
                showNotification('OTP has expired. Please request a new one.', 'error');
            }
        }, 1000);
    }
    
    // Update OTP timer display
    function updateTimerDisplay(timerDisplay) {
        const now = new Date().getTime();
        const timeLeft = otpExpiryTime - now;
        
        if (timeLeft <= 0) {
            timerDisplay.textContent = 'OTP expired';
            return 0;
        }
        
        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
        
        timerDisplay.textContent = `Resend OTP in: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        return timeLeft;
    }
    
    // Verify OTP entered by user
    function verifyOtp() {
        const otpInputs = document.querySelectorAll('.otp-input');
        let enteredOtp = '';
        
        otpInputs.forEach(input => {
            enteredOtp += input.value;
        });
        
        if (enteredOtp.length !== 6) {
            showNotification('Please enter the complete 6-digit OTP.', 'error');
            return;
        }
        
        if (enteredOtp === generatedOtp) {
            clearInterval(otpTimer);
            otpModal.classList.remove('show');
            resetPasswordModal.classList.add('show');
            showNotification('OTP verified successfully. Please set your new password.', 'success');
        } else {
            showNotification('Invalid OTP. Please try again.', 'error');
        }
    }
    
    // Move to next OTP input field
    function moveToNext(currentInput) {
        const nextInput = currentInput.nextElementSibling;
        
        // Only allow numbers
        currentInput.value = currentInput.value.replace(/\D/g, '');
        
        if (currentInput.value !== '' && nextInput) {
            nextInput.focus();
        }
        
        // Auto-submit if all fields are filled
        const allInputs = document.querySelectorAll('.otp-input');
        const allFilled = Array.from(allInputs).every(input => input.value !== '');
        
        if (allFilled) {
            verifyOtp();
        }
    }
    
    // Simulate sending SMS (in a real app, this would call an SMS API)
    function simulateSendSms(phone, message) {
        console.log(`SMS to ${phone}: ${message}`);
        // In a real implementation, you would use an SMS service like Twilio, Nexmo, etc.
        // Example: 
        // twilioClient.messages.create({
        //     body: message,
        //     to: phone,
        //     from: '+1234567890'
        // });
    }
    
    // Validate email format
    function isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }
    
    // Validate phone number format (10 digits)
    function isValidPhone(phone) {
        return /^\d{10}$/.test(phone);
    }
    
    // Check if password meets strength requirements
    function isStrongPassword(password) {
        const minLength = 8;
        const hasUpperCase = /[A-Z]/.test(password);
        const hasLowerCase = /[a-z]/.test(password);
        const hasNumbers = /\d/.test(password);
        const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(password);
        
        return password.length >= minLength && 
               hasUpperCase && 
               hasLowerCase && 
               hasNumbers && 
               hasSpecialChar;
    }
    
    // Validate user credentials
    async function validateCredentials(email, password) {
        // Check test accounts first
        if (testAccounts[email] && testAccounts[email] === password) {
            return true;
        }
        
        // Check registered users
        const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers'));
        if (registeredUsers[email] && registeredUsers[email].password === password) {
            return true;
        }
        
        return false;
    }
    
    // Show notification
    function showNotification(message, type) {
        notification.textContent = message;
        notification.className = 'notification ' + type;
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 5000);
    }
    
    // Initialize the application
    document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
